services:
  rethinkdb:
    image: rethinkdb:latest
    container_name: rethinkdb-order-drink
    volumes:
      - ./rethinkdb-data:/data
    ports:
      - "8080:8080"
      - "28015:28015"
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8080 || exit 1"]
      interval: 5s
      retries: 20
      start_period: 5s

  app:
    build:
      context: .
      args:
        REACT_APP_TITLE: ${REACT_APP_TITLE}
        REACT_APP_STORE_NAME: ${REACT_APP_STORE_NAME}
        REACT_APP_ROOT_IP_ADDRESS: ${REACT_APP_ROOT_IP_ADDRESS}
        REACT_APP_REAL_ROOT_IP_ADDRESS: ${REACT_APP_REAL_ROOT_IP_ADDRESS}
        REACT_APP_DISABLED_MENU: ${REACT_APP_DISABLED_MENU}
    image: gray9527/order-drink-app:latest # 若本地測試可註解掉
    container_name: order-drink-app
    environment:
      - ROOT_IP_ADDRESS=${REACT_APP_ROOT_IP_ADDRESS}
      - REACT_APP_TITLE=${REACT_APP_TITLE}
      - REACT_APP_STORE_NAME=${REACT_APP_STORE_NAME}
      - REACT_APP_ROOT_IP_ADDRESS=${REACT_APP_ROOT_IP_ADDRESS}
      - REACT_APP_REAL_ROOT_IP_ADDRESS=${REACT_APP_REAL_ROOT_IP_ADDRESS}
      - REACT_APP_DISABLED_MENU=${REACT_APP_DISABLED_MENU}
    ports:
      - "5000:5000"
    depends_on:
      rethinkdb:
        condition: service_healthy
